#autoload

_dsa_cache=/tmp/.dsa-cache-$USER-$HOST

if [[ -n "$*" || ! -r "$_dsa_cache" ]]; then
  recalc_ssh_agent_cache || return
fi  

source "$_dsa_cache"
cat <<EOF 
Read ssh-agent details from cache:
    pid:    $SSH_AGENT_PID
    socket: $SSH_AUTH_SOCK
EOF

export SSH_AGENT_PID SSH_AUTH_SOCK

if [[ -e /proc ]] &&
   ( [[ ! -e /proc/$SSH_AGENT_PID ]] ||
     ! grep -q ssh-agent /proc/$SSH_AGENT_PID/cmdline ); then
  echo "\nInvalid ssh-agent pid $SSH_AGENT_PID; restarting ...\n"
  dsa restart
fi
