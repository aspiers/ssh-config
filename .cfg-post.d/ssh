#!/bin/sh

confdir=$HOME/.ssh
confsubdir=$confdir/config.d
config=$confdir/config

[ -d $confsubdir ] || mkdir -p $confsubdir
chmod go-rwx $confdir $confsubdir

if [ -e $config ] && ! grep -q "^# Autogenerated from $0" $config; then
    echo "Error: won't overwrite hand-written $config, please break into parts" >&2
    exit 1
fi

cat <<EOF > $config
# Autogenerated from $0 at `date`"

EOF
cat $confsubdir/* >> $config
